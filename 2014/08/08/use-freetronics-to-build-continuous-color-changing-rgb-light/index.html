<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Use Freetronics to Build Continuous Color Changing RGB Light | nickTD.dev</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta content="article" property="og:type">
<meta content="Use Freetronics to Build Continuous Color Changing RGB Light" property="og:title">
<meta content="http://nickTD.com/2014/08/08/use-freetronics-to-build-continuous-color-changing-rgb-light/" property="og:url">
<meta property="og:image">
<meta content="nickTD.dev" property="og:site_name">
<meta content="The Idea
When I went through all the parts inside Freetronics Experiment Kit, and when I saw the RGB LED lie inside the kit, I had this idea of continuous changing color LED. I had this image in my mi" property="og:description">
<meta content="summary" name="twitter:card">
  
    <link rel="alternative" href="/atom.xml" title="nickTD.dev" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="http://fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">nickTD.dev</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://nickTD.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-use-freetronics-to-build-continuous-color-changing-rgb-light" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/08/08/use-freetronics-to-build-continuous-color-changing-rgb-light/" class="article-date">
  <time datetime="2014-08-08T02:46:58.000Z" itemprop="datePublished">Aug 8 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Use Freetronics to Build Continuous Color Changing RGB Light
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="The_Idea">The Idea</h2>
<p>When I went through all the parts inside Freetronics Experiment Kit, and when I saw the RGB LED lie inside the kit, I had this idea of continuous changing color LED. I had this image in my mind that the color of the RGB LED just changes and never stop.</p>
<h2 id="Connect_the_Hardware">Connect the Hardware</h2>
<p>Follow instructions of “Project 7:RGB LED” on page 32 in <a href="http://cdn.shopify.com/s/files/1/0045/8932/files/ExpKitGettingStartedGuide1.4.pdf?1121" target="_blank">Arduino Experimenters Kit Project Guide</a>.</p>
<h2 id="Software">Software</h2>
<p>To help people new to programming, I decided that every new version only makes a small change to the older one.</p>
<h3 id="V1">V1</h3>
<p>Let’s start with something simple: giving RGB LED a random color when we start the kit.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="code"><pre><span class="keyword">int</span> leds[] = {<span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>};
<span class="comment">// RGB pins.</span>
<span class="comment">// Change this according to your own hardware setting.</span>

<span class="keyword">void</span> setup() {
  <span class="keyword">for</span>(<span class="keyword">int</span> thisLed = <span class="number">0</span>; thisLed &lt; <span class="number">3</span>; thisLed++) {
    pinMode(leds[thisLed], OUTPUT);
    analogWrite(leds[thisLed], randomColor());
  }
}

<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> K_COLOR_MIN = <span class="number">0</span>;
<span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> K_COLOR_MAX = <span class="number">255</span>;

<span class="comment">// Generate random color value from K_COLOR_MIN, to K_COLOR_MAX.</span>
<span class="keyword">int</span> randomColor() {
  <span class="keyword">return</span> random(K_COLOR_MIN, K_COLOR_MAX);
}

<span class="keyword">void</span> loop() {
}
</pre></td></tr></table></figure>


<p>This snippet of code will setup the pin mode for the pins on RGB LED and then do nothing since there’s no code inside function <code>loop</code>.</p>
<a id="more"></a>

<h3 id="V2">V2</h3>
<p>Let’s say we want the color of the RGB LED changes every 0.5 second. Then the only change is inside <code>loop</code> function and it should look like this:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
</pre></td><td class="code"><pre><span class="keyword">void</span> loop() {
  <span class="keyword">for</span>(<span class="keyword">int</span> thisLed = <span class="number">0</span>; thisLed &lt; <span class="number">3</span>; thisLed++) {
    analogWrite(leds[thisLed], randomColor());
  }
  delay(<span class="number">500</span>); <span class="comment">// 500 milliseconds = 0.5 seconds</span>
}
</pre></td></tr></table></figure>


<p>As you can see that we almost copied the code in <code>setup</code>. But we call function <code>delay</code> after setting RGB LED to a different color. The <code>delay</code> function “tells the Arduino to stop doing anything until a certain period of time is up.”(copied from <a href="http://cdn.shopify.com/s/files/1/0045/8932/files/ExpKitGettingStartedGuide1.4.pdf?1121" target="_blank">Arduino Experimenters Kit Project Guide</a>) That’s why there’s a 0.5 second pause from one change of color to another.</p>
<h3 id="V2-5">V2.5</h3>
<p>This line saying <code>analogWrite(leds[thisLed], randomColor());</code> is repeated twice. It’s duplicated code! I don’t like that.<br>Let’s do a little bit refactoring here by adding following function <code>setLed</code>.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre>1
2
3
</pre></td><td class="code"><pre><span class="keyword">void</span> setLed(<span class="keyword">int</span> led, <span class="keyword">int</span> color) {
  analogWrite(led, color);    
}
</pre></td></tr></table></figure>


<p>And changes <code>analogWrite(leds[thisLed], randomColor());</code> to <code>setLed(leds[thisLed], randomColor());</code>.</p>
<p>You might wonder: “It’s still duplicated code. How’s this better?”</p>
<p><!-- TODO --><br>First of all, it gives the duplicated code a name. Without a proper name, meaning of a block of a code maybe not that obvious as it is to you to others reading your code.<br>Second of all, it cut down our code which depends on other code. This can be handy. Let’s say function <code>analogWrite</code> was renamed to <code>writeToAnalog</code>, then with this refactored code, you only need to make this change once.</p>
<p>(If you come up with something else why this refactoring is good, please feel free to reply in the comment :D)</p>
<h3 id="V3">V3</h3>
<p>Now, the color of LED changes periodically. But there’s no transition from one color to another. Let’s add that.</p>
<h4 id="V3-1">V3.1</h4>
<p>First, we need two variables to record current colors and target colors. And we want to generate two sets of random colors, one as LED’s current color, another as the target color.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="code"><pre><span class="keyword">int</span> currentValues[<span class="number">3</span>];
<span class="keyword">int</span> targetValues[<span class="number">3</span>];

<span class="keyword">void</span> setup() {
  <span class="keyword">for</span>(<span class="keyword">int</span> thisLed = <span class="number">0</span>; thisLed &lt; <span class="number">3</span>; thisLed++) {
    pinMode(leds[thisLed], OUTPUT);

    <span class="keyword">int</span> currentValue = randomColor();
    setLed(leds[thisLed], currentValue);

    currentValues[thisLed] = currentValue;
    targetValues[thisLed] = randomColor();
  }
}
</pre></td></tr></table></figure>


<h4 id="V3-2">V3.2</h4>
<p>To Be Continued.</p>
<h3 id="Possible_Pitfalls">Possible Pitfalls</h3>
<h4 id="Output_to_one_pin_at_a_time">Output to one pin at a time</h4>
<p>If all the pins on RGB LED don’t get updated at the same time, the voltage of the pin which doesn’t get updated won’t hold. And that means actually the value on that pin will change, the color too.</p>
<h4 id="Reading_Values_from_OUTPUT_pin">Reading Values from OUTPUT pin</h4>
<p>At the beginning of Version 3, I once thought, “Hey, why can’t I just get current values of RGB color by reading from the pins and compare those with my target values.”</p>
<p>FAILED.</p>
<p>Here’s why:</p>
<p>The pin mode of LED’s pins are all set to <code>OUTPUT</code>, which means it really just can’t read values <strong>IN</strong>. Well, I tried and it just doesn’t work this way.</p>
<h2 id="The_End">The End</h2>
<p>Feel free to ask me anything. :D</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://nickTD.com/2014/08/08/use-freetronics-to-build-continuous-color-changing-rgb-light/" data-id="qcsk3igtwmo7gy31" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2014/04/25/fixing-hexos-deployer/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Fixing Hexo&#39;s Deployer</div>
    </a>
  
</nav>

  
</article>

</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 Nicholas T.<br>
      Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>


<script type="text/javascript" src="/js/script.js"></script>
  </div>
</body>
</html>